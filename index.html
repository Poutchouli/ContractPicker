<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aide √† la D√©cision Strat√©gique</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
    <header class="main-header">
        <h1><i class="fa-solid fa-compass-drafting"></i> Aide √† la D√©cision Strat√©gique</h1>
        <div>
            <button data-action="open-ai-modal" class="btn-header" title="Param√®tres IA"><i class="fa-solid fa-brain"></i></button>
            <span id="status-indicator" class="status-indicator"></span>
        </div>
    </header>

    <main class="main-layout-container">

        <!-- Colonne Principale: Configuration et R√©sultats -->
        <div class="main-column">
            <div class="widget" data-widget-id="config">
                <div class="card">
                    <h2 class="card-header"><i class="fa-solid fa-sliders"></i> Configuration & Simulation</h2>
                    <div class="card-content">
                        <div class="form-group"><label for="type-contrat">1. Type de Contrat</label><select id="type-contrat"></select></div>
                        <div id="memo-container" class="memo-box" style="display:none;"></div>
                        <div id="questionnaire-container"></div>
                        <h3 class="sub-header">2. Param√®tres de Simulation</h3>
                        <form id="form-simulation" class="simulation-grid">
                            <div class="form-group"><label for="sim-volume-nb">Volume N&B / mois</label><input type="number" id="sim-volume-nb" value="5000" required></div>
                            <div class="form-group"><label for="sim-volume-couleur">Volume Couleur / mois</label><input type="number" id="sim-volume-couleur" value="500" required></div>
                            <div class="form-group grid-span-2"><label for="sim-duree">Dur√©e de comparaison (mois)</label><input type="number" id="sim-duree" value="36" required></div>
                        </form>
                        <h3 class="sub-header">3. Pond√©ration des Crit√®res</h3>
                        <div id="ponderation-container">
                            <div class="form-group"><label for="poids-cout">üêñ Importance : <span id="valeur-poids-cout">50</span>%</label><input type="range" id="poids-cout" min="0" max="100" value="50" class="slider"></div>
                            <div class="form-group"><label for="poids-qualite">‚è±Ô∏è Importance : <span id="valeur-poids-qualite">20</span>%</label><input type="range" id="poids-qualite" min="0" max="100" value="20" class="slider"></div>
                            <div class="form-group"><label for="poids-modele">‚öôÔ∏è Importance : <span id="valeur-poids-modele">15</span>%</label><input type="range" id="poids-modele" min="0" max="100" value="15" class="slider"></div>
                            <div class="form-group"><label for="poids-ressenti">ü§î Importance : <span id="valeur-poids-ressenti">15</span>%</label><input type="range" id="poids-ressenti" min="0" max="100" value="15" class="slider"></div>
                        </div>
                        <button type="submit" form="form-simulation" class="btn btn-principal full-width"><i class="fa-solid fa-play"></i> Lancer la Comparaison</button>
                    </div>
                </div>
            </div>
            <div class="widget" data-widget-id="resultats">
                <div class="card" id="section-resultats" style="display:none;">
                    <h2 class="card-header"><i class="fa-solid fa-chart-pie"></i> Vue d'Ensemble</h2>
                    <div class="card-content">
                        <div class="chart-container"><canvas id="graphique-scores"></canvas></div>
                        <div class="chart-container" style="margin-top: 2rem;"><canvas id="graphique-radar"></canvas></div>
                        <div class="table-container"><table id="tableau-resultats"></table></div>
                    </div>
                </div>
                 <div class="card" id="section-analyse" style="display:none;">
                    <h2 class="card-header"><i class="fa-solid fa-lightbulb"></i> Conclusion & Recommandation</h2>
                    <div class="card-content" id="analyse-container"></div>
                </div>
            </div>
        </div>

        <!-- Colonne Lat√©rale: Gestion des Offres -->
        <div class="sidebar-column">
            <div class="widget" data-widget-id="offres">
                 <div class="card">
                    <h2 class="card-header"><i class="fa-solid fa-list-check"></i> Gestion des Offres</h2>
                    <div class="card-content">
                        <div class="actions-fichiers">
                            <button data-action="open-offer-modal" class="btn btn-principal"><i class="fa-solid fa-plus"></i> Nouvelle Offre</button>
                            <button data-action="simulate-offer" class="btn btn-simulation" title="Ajouter une offre concurrente fictive"><i class="fa-solid fa-wand-magic-sparkles"></i> Simuler</button>
                            <button data-action="export-csv" class="btn btn-secondaire" title="Exporter les donn√©es en CSV"><i class="fa-solid fa-file-export"></i> Exporter</button>
                            <button data-action="import-csv" class="btn btn-secondaire" title="Importer des donn√©es CSV"><i class="fa-solid fa-file-import"></i> Importer</button>
                            <input type="file" id="input-csv" accept=".csv" style="display: none;">
                        </div>
                         <div id="actions-selection" class="actions-selection-box" style="display:none;">
                            <button data-action="group-selection" class="btn btn-info"><i class="fa-solid fa-object-group"></i> Grouper la s√©lection</button>
                            <button data-action="delete-selection" class="btn btn-danger"><i class="fa-solid fa-trash-can"></i> Supprimer la s√©lection</button>
                        </div>
                        <div id="liste-offres"></div>
                        <button data-action="purge-offers" class="btn btn-danger full-width" style="margin-top: 1rem;"><i class="fa-solid fa-fire-extinguisher"></i> Purger toutes les offres</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Fen√™tre Modale pour la Saisie d'Offre -->
    <div id="offre-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modal-title"></h3><button data-action="close-offer-modal" class="close-button">&times;</button></div>
            <div class="modal-body">
                <form id="form-offre">
                    <input type="hidden" id="offre-id">
                    <div class="form-grid">
                        <div class="form-group"><label for="prestataire">Prestataire</label><input type="text" id="prestataire" required></div>
                        <div class="form-group"><label for="fabricant">Fabricant</label><select id="fabricant" required></select></div>
                        <div class="form-group"><label for="modele">Mod√®le</label><select id="modele" required></select><small id="prix-indicatif-modele"></small></div>
                        <div class="form-group"><label for="gti-heures">GTI (heures)</label><input type="number" id="gti-heures" required></div>
                    </div>
                    <h4 class="sub-header">Conditions du Contrat</h4>
                     <div class="form-grid">
                        <div class="form-group"><label for="duree">Dur√©e (mois)</label><input type="number" id="duree" required></div>
                        <div class="form-group"><label for="location">Loyer (‚Ç¨/mois)</label><input type="number" step="0.01" id="location" required></div>
                        <div class="form-group"><label for="cout-nb">Co√ªt N&B (‚Ç¨)</label><input type="number" step="0.00001" id="cout-nb" required></div>
                        <div class="form-group"><label for="cout-couleur">Co√ªt Couleur (‚Ç¨)</label><input type="number" step="0.00001" id="cout-couleur" required></div>
                    </div>
                    <h4 class="sub-header">Co√ªts Additionnels</h4>
                    <div id="couts-additionnels-container"></div>
                    <button type="button" data-action="add-cost-field" class="btn btn-secondaire"><i class="fa-solid fa-plus"></i> Ajouter un co√ªt</button>
                    <hr>
                    <div class="form-group"><label for="notes">Notes & Clauses</label><textarea id="notes"></textarea></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" data-action="close-offer-modal" class="btn btn-secondaire">Annuler</button>
                <button type="submit" form="form-offre" class="btn btn-principal"><i class="fa-solid fa-save"></i> Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Fen√™tre Modale pour les Param√®tres IA -->
    <div id="ai-settings-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header"><h3><i class="fa-solid fa-brain"></i> Param√®tres IA (Gemini)</h3><button data-action="close-ai-modal" class="close-button">&times;</button></div>
            <div class="modal-body">
                <p>Pour activer l'analyse par IA, veuillez fournir votre cl√© API Gemini. Vous pouvez en obtenir une sur <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>.</p>
                <div class="form-group"><label for="gemini-api-key">Cl√© API Gemini</label><input type="password" id="gemini-api-key" placeholder="Entrez votre cl√© API ici"></div>
            </div>
            <div class="modal-footer"><button data-action="save-api-key" class="btn btn-principal">Enregistrer</button></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="js/app.js" type="module"></script>
</body>
</html>
